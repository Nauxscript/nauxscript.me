<div id="group" class="group" h-42 text-6 m-y-16 font-serif-naux>
 <div id="en" absolute flex flex-col>
    <span>Empty your minds,</span>
    <span>be formless,shapeless,like water.</span>
    <span>now you put water into a cup,it becomes the cup;</span>
    <span>you put it into a bottle,it becomes the bottle;</span>
    <span>you put it in a teapot,it becomes the teapot.</span>
    <span>Water can flow,or it can crash.</span>
    <span>Be water,my friend.</span>
    <!-- <span>一二三</span>
    <span>上而已啊啊，等等迪恩片</span>
    <span>筛法，定价，</span>
    <span>灯光，阿河，</span>
    <span>皮儿，男女。</span>
    <span>敌人叮咛，身边开本。</span>
    <span>掯勒很难开来能。</span> -->
  </div>

  <div id="cn" absolute flex flex-col>
    <span>疏雜念</span>
    <span>身如水之虛，體似水之流。</span>
    <span>入杯，即杯，</span>
    <span>至瓶，成瓶，</span>
    <span>進壺，為壺。</span>
    <span>亦舒亦急，可湍可緩。</span>
    <span>可謂人水合一也。</span>
  </div>

    <!-- <h1 id="en" absolute text-20>Vue</h1>
    <h1 id="cn" absolute text-20>汤卓轩</h1> -->
  
</div>

<div id="container">
	<span id="text1"></span>
	<span id="text2"></span>
</div>
<svg id="filters">
	<defs>
		<filter id="threshold">
			<feColorMatrix in="SourceGraphic"
					type="matrix"
					values="1 0 0 0 0
									0 1 0 0 0
									0 0 1 0 0
									0 0 0 240 -110" />
		</filter>
	</defs>
</svg>

<input type="range" id="val" name="val"
         min="0" max="1" step="0.01">

<button onclick="go()">start</button>
<button onclick="gogo()">start2</button>
<button onclick="stop()">stop</button>


<script is:inline>
const text1 = document.getElementById("cn")
const	text2 = document.getElementById("en")
const	container = document.getElementById("group")

const morphTime = 1;
const cooldownTime = 0.25;
let time = new Date();
let morph = 0;

function doMorph() {
	
	
	// if (fraction > 1) {
	// 	cooldown = cooldownTime;
	// 	fraction = 1;
	// }
	
	setMorph(fraction);
}

function setMorph(fraction) {
	text2.style.filter = `blur(${Math.min(8 / fraction - 8, 100)}px)`;
	// text2.style.filter = `blur(${4*fraction}px)`;
	text2.style.opacity = `${Math.pow(fraction, 0.4) * 100}%`;
	
	fraction = 1 - fraction;
	text1.style.filter = `blur(${Math.min(8 / fraction - 8, 100)}px)`;
	// text1.style.filter = `blur(${4*fraction}px)`;
	text1.style.opacity = `${Math.pow(fraction, 0.4) * 100}%`;
}

const input = document.getElementById('val');
// nauxscript console
console.log('%c nauxscript ', 'color: red', )
input.addEventListener('change', (e) => {
  setMorph(e.target.value)
});

const step = 0.01
let vall = 0
let stepnow = step

function myAnimation() {
  console.log('myAnimation');
  if (vall > 1 || vall < 0) return
  input.value = morph
  vall += stepnow 
  console.log(vall);
  setMorph(vall)
  requestAnimationFrame(myAnimation)
}

function go () {
  time = new Date()
  console.log(vall);
  if (vall >= 1) {
    vall = 1
    stepnow = -step
  } else if (vall <= 0) {
    vall = 0
    stepnow = step
  } else {
    stepnow = -stepnow
  }
  myAnimation()
}



let forward = true
let s = 0

function gogo () {
  console.log(s);
  time = new Date()
  if (s >= 1) {
    morph = 0
    forward = false
  } else if (s <= 0) {
    morph = 0
    forward = true 
  } else {
    forward = !forward  
  }
  movement()
}

function movement() {
  // if (forward) s = morph 
  // if (!forward) s = 1 - morph 
  if (morph > 1) return
  let newTime = new Date();
	let dt = (newTime - time) / 1000;
	time = newTime;
  morph += dt
	let fraction = morph / morphTime;
  console.log('%c nauxscript s', 'color: red', fraction)
  if (forward) s = fraction 
  if (!forward) s = 1 - fraction
  input.value = s 
  setMorph(s)
  requestAnimationFrame(movement)
}

container.addEventListener('mouseenter', gogo)
container.addEventListener('mouseleave', gogo)
</script>

<style>
#group {
  /* filter: none; */
  filter: url(#threshold) blur(0.6px);
  /* transition: all 1s; */
  /* filter: url(#threshold) blur(-1px); */
}

#en {
  opacity: 0;
  /* transition: all .3s; */
}

#cn {
  /* opacity: 1; */
  /* transition: all .3s; */
}

@keyframes tran {
  0% {
    filter: url(#threshold) blur(-1px);
  }
  
  /* 50% {
    filter: url(#threshold) blur(10px);
  } */

  100% {
    filter: url(#threshold) blur(100px);
  }
}

#container {
	position: absolute;
	margin: auto;
	width: 100vw;
	height: 80pt;
	top: 0;
	bottom: 0;
  filter: url(#threshold) blur(0.6px);
}

#text1, #text2 {
	position: absolute;
	width: 100%;
	display: inline-block;
	font-size: 80pt;
	text-align: center;
	user-select: none;
}
</style>